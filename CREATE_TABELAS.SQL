IF NOT EXISTS (SELECT NAME FROM MASTER.SYS.DATABASES WHERE NAME = 'BARBEARIA')
BEGIN
	CREATE DATABASE BARBEARIA
END

IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'PERMISSAO')
BEGIN
	CREATE TABLE PERMISSAO(
		ID BIGINT IDENTITY(1,1) PRIMARY KEY,
		NOME VARCHAR(100)
	);
END

IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'FUNCIONARIO')
BEGIN
	CREATE TABLE FUNCIONARIO(
		ID BIGINT IDENTITY(1,1) PRIMARY KEY,
		NOME VARCHAR(50),
		CARGO VARCHAR(50)
	);
END

IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'USUARIO')
BEGIN
	CREATE TABLE USUARIO(
		ID BIGINT IDENTITY(1,1) PRIMARY KEY,
		NOME VARCHAR(100),
		LOGIN VARCHAR(50),
		SENHA VARCHAR(100),
		ATIVO INT,
		PERMISSAO BIGINT,
		FUNCIONARIO BIGINT
	);
	
	ALTER TABLE USUARIO ADD CONSTRAINT FK_PERMISSAO FOREIGN KEY(PERMISSAO) REFERENCES PERMISSAO(ID)
	ALTER TABLE USUARIO ADD CONSTRAINT FK_FUNCIONARIOID FOREIGN KEY(FUNCIONARIO) REFERENCES FUNCIONARIO(ID)
END

IF NOT EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'ATENDIMENTO')
BEGIN
	CREATE TABLE ATENDIMENTO(
		ID BIGINT IDENTITY(1,1) PRIMARY KEY,
		DATAHORARIO VARCHAR(100),
		FUNCIONARIO BIGINT,
		USUARIO BIGINT
	);
	
	ALTER TABLE ATENDIMENTO ADD CONSTRAINT FK_FUNCIONARIO FOREIGN KEY(FUNCIONARIO) REFERENCES FUNCIONARIO(ID)
	ALTER TABLE ATENDIMENTO ADD CONSTRAINT FK_USUARIO FOREIGN KEY(USUARIO) REFERENCES USUARIO(ID)
END

INSERT INTO PERMISSAO(NOME) VALUES('TOTAL');
INSERT INTO PERMISSAO(NOME) VALUES('BARBEIRO');
INSERT INTO PERMISSAO(NOME) VALUES('CLIENTE');
INSERT INTO USUARIO(NOME,LOGIN,SENHA,ATIVO,PERMISSAO) VALUES('ADMIN','ADMIN','$2a$10$R2fNIDW1DB/wULohtHImquLezDpaFyytU20eCDhpKROHXICo3h2RG',1, 1);
